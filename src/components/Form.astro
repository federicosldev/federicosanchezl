---
// Tu componente Astro
---

<div class="mt-9">
  <form id="contact-form" class="flex flex-col gap-4 pb-5">
    <input
      id="name"
      name="user_name"
      required
      class="px-3 pt-3 pb-4 border border-primary-purple rounded-xl bg-dark text-2xl text-primary-purple"
      type="text"
      placeholder="Nombre"
    />
    <input
      id="email"
      name="user_email"
      required
      class="px-3 pt-3 pb-4 border border-primary-purple rounded-xl bg-dark text-2xl text-primary-purple"
      type="email"
      placeholder="Email"
    />
    <textarea
      id="message"
      name="message"
      required
      class="px-3 pt-3 pb-4 border border-primary-purple rounded-xl bg-dark text-2xl text-primary-purple"
      placeholder="Mensaje"></textarea>
    <button
      id="submitButton"
      class="px-3 pt-3 pb-4 border border-primary-purple rounded-xl bg-primary-pink hover:bg-dark hover:text-primary-purple text-2xl text-primary-purple transition-colors font-bold"
      type="submit"
    >
      Enviar
    </button>
  </form>
  <p id="status-message" class="text-white"></p>
</div>

<!-- Incluir EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"
></script>

<!-- IMPORTANTE: Inicializar EmailJS antes de cualquier uso -->
<script>
  // Asegurarse de que EmailJS está cargado
  (function () {
    // Inicializar EmailJS con tu PUBLIC KEY
    emailjs.init('5RtqdNlugODDFGQcg');
  })();
</script>

<!-- Script del formulario -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contact-form');
    const statusElement = document.getElementById('status-message');

    if (form) {
      form.addEventListener('submit', function (e) {
        e.preventDefault();

        const submitButton = document.getElementById('submitButton');
        if (submitButton) {
          submitButton.disabled = true;
        }

        // Asegurarse de que los parámetros estén correctos
        emailjs
          .sendForm(
            'service_x9lnkbl', // Tu Service ID
            'template_yuixtys', // Tu Template ID
            this, // El formulario
            '5RtqdNlugODDFGQcg', // Tu Public Key
          )
          .then(function (response) {
            console.log('SUCCESS!', response.status, response.text);
            if (statusElement) {
              statusElement.textContent = 'Su mensaje fue enviado con éxito';
              statusElement.className = 'text-green-500';
            }
            form.reset();
          })
          .catch(function (error) {
            console.log('FAILED...', error);
            if (statusElement) {
              statusElement.textContent = 'No se pudo enviar: ' + error.text;
              statusElement.className = 'text-red-500';
            }
          })
          .finally(function () {
            if (submitButton) {
              submitButton.disabled = false;
            }
          });
      });
    }
  });
</script>
